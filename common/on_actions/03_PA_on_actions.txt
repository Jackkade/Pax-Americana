
on_startup = {
    pre_colonial_culture_preserver_effect = yes
}

##scope = colony province, FROM = owner country or province if there's a minority expulsion source, fires when the colony is created
on_colony_established = {
    add_province_triggered_modifier = pa_new_colony
    add_colonysize = 1000
}

# province
# root = location, from = country that abandons colony
# Fired right before the colony is abandoned.
on_abandon_colony = {
    reset_to_pre_colonial_culture_religion = yes
    province_event = { 
        id = colony_reset_culture_vars.100
        days = 1
    }
}

#scope = new country, FROM = parent country
on_colonial_nation_established = {
        #   Fix to colonial nations adopting native culture
    if = {
        limit = {
            NOT = {
                culture_group = FROM
            }
        }
        change_primary_culture = FROM
    }
    if = {
        limit = {
            NOT = {
                religion_group = FROM
            }
        }
        change_religion = FROM
    }
    every_owned_province = {
        limit = {
            has_active_triggered_province_modifier = pa_new_colony
        }
        add_province_modifier = {
            name = pa_new_colonial_nation_colony
            duration = 9125		#Currently 25 Years, may need to be lower
        }
        overlord = {
            random_owned_province = {
                limit = {
                    NOT = { has_province_modifier = pa_new_colonial_nation_colony_overlord_upkeep }
                }
                add_province_modifier = {
                    name = pa_new_colonial_nation_colony_overlord_upkeep
                    #hidden = yes
                    duration = 9125		#Currently 25 Years, may need to be lower
                }
            }
        }
    }
    add_country_modifier = { 
        name = pa_new_colonial_nation
        duration = 9125 
    }
}
#Fix to colonial nation bankruptcy when fed colonies
on_province_owner_change = {
    if = {
        limit = {
            owner = {
                is_colonial_nation = yes
            }
            has_province_modifier = pa_new_colony_cooldown
        }
        owner = {
            overlord = {
                random_owned_province = {
                    limit = {
                        NOT = { has_province_modifier = pa_new_colonial_nation_colony_overlord_upkeep }
                    }
                    add_province_modifier = {
                        name = pa_new_colonial_nation_colony_overlord_upkeep
                        #hidden = yes
                        duration = 9125		#Currently 25 Years, may need to be lower
                    }
                }
            }
        }
        add_province_modifier = {
            name = pa_new_colonial_nation_colony
            duration = 9125		#Currently 25 Years, may need to be lower
        }
    }
}

on_conquest = {
	if = {
        limit = {
            is_valid_for_conquest_colony = yes
            owner = {   #Natives Don't need to colonize their conquests
                NOT = {
                    OR = {
                        technology_group = north_american
                        technology_group = south_american
						technology_group = high_american
                    }
                }
            }
        }
        add_province_modifier = {
            name = pa_new_colony_cooldown
            duration = 9125		#Currently 25 Years, may need to be lower
        }
        add_province_triggered_modifier = pa_new_colony
        add_nationalism = -20   #Nerf to sepratism, colony already represented
        set_base_tax = 1 
        set_base_production = 1
        set_base_manpower = 1
        remove_building = college
        remove_building = marketplace
        remove_building = workshop
        remove_building = temple
        remove_building = barracks
        remove_building = shipyard
        remove_building = fort_15th
        remove_building = coastal_defence
        remove_building = courthouse
        remove_building = dock
        remove_building = regimental_camp
        remove_building = fort_16th
        remove_building = naval_battery
        remove_building = cathedral
        remove_building = university
        remove_building = trade_depot
        remove_building = grand_shipyard
        remove_building = training_fields
        remove_building = fort_17th
        remove_building = stock_exchange
        remove_building = counting_house
        remove_building = town_hall
        remove_building = drydock
        remove_building = conscription_center
        remove_building = fort_18th
        remove_building = wharf
        remove_building = weapons
        remove_building = textile
        remove_building = plantations
        remove_building = tradecompany
        remove_building = farm_estate
        remove_building = mills
        remove_building = furnace
        remove_building = ramparts
        remove_building = soldier_households
        remove_building = impressment_offices
        remove_building = state_house
        remove_building = road_network
        remove_building = mb_canal
        remove_building = grain_depot
        remove_building = mint
        remove_building = tax_assessor
        remove_building = armory
        remove_building = arsenal
        remove_building = naval_arsenal
        remove_building = naval_base
        remove_building = constable
        remove_building = treasury_office
        remove_building = post_office
        remove_building = customs_house
        remove_building = march_building
        remove_building = glorious_monument
        remove_building = spy_agency
    }
    if = {
        limit = {
            FROM = {
                is_colonial_nation = yes
            }
            has_province_modifier = pa_new_colonial_nation_colony
        }
        FROM = {
            overlord = {
				random_owned_province = {
					limit = {
						has_province_modifier = pa_new_colonial_nation_colony_overlord_upkeep
					}
					remove_province_modifier = pa_new_colonial_nation_colony_overlord_upkeep
				}
			}
        }
    }
}

on_colony_finished = { #ROOT - Province
	#on_colony_finished_effect = yes
    reset_to_pre_colonial_culture_religion = yes
    add_permanent_province_modifier = {
        name = pa_new_colony_cooldown
        duration = 9125		#Currently 25 Years, may need to be lower
    }
    if = {
        limit = {
            owner = {
                has_active_policy = colonial_expansions
                
            }
        }
        add_permanent_province_modifier = {
            name = pa_new_colony_reduced_cost_3
            duration = 9125		#Currently 25 Years, may need to be lower
        }
    }
    else_if = {
        limit = {
            owner = {
                full_idea_group = expansion_ideas
            }
        }
        add_permanent_province_modifier = {
            name = pa_new_colony_reduced_cost_1
            duration = 9125		#Currently 25 Years, may need to be lower
        }
    }

    if = {     #anti limitless expansion modifiers
        limit = {
            owner = {
                primitives = yes 
            }
        }
        add_permanent_province_modifier = {
            name = pa_new_colony_increased_cost_native
            duration = 9125		#Currently 25 Years, may need to be lower
        }
    }

    if = {     #anti limitless expansion modifiers
        limit = {
            owner = {
                calc_true_if = {
                    all_owned_province = {
                        has_province_modifier = pa_new_colony_cooldown 
                    }
                    amount = 35
                }
            }
        }
        add_permanent_province_modifier = {
            name = pa_new_colony_increased_cost_4
            duration = 9125		#Currently 25 Years, may need to be lower
        }
    }
    else_if = {     #anti limitless expansion modifiers
        limit = {
            owner = {
                calc_true_if = {
                    all_owned_province = {
                        has_province_modifier = pa_new_colony_cooldown 
                    }
                    amount = 30
                }
            }
        }
        add_permanent_province_modifier = {
            name = pa_new_colony_increased_cost_3
            duration = 9125		#Currently 25 Years, may need to be lower
        }
    }
    else_if = {     #anti limitless expansion modifiers
        limit = {
            owner = {
                calc_true_if = {
                    all_owned_province = {
                        has_province_modifier = pa_new_colony_cooldown 
                    }
                    amount = 25
                }
            }
        }
        add_permanent_province_modifier = {
            name = pa_new_colony_increased_cost_2
            duration = 9125		#Currently 25 Years, may need to be lower
        }
    }
    else_if = {     #anti limitless expansion modifiers
        limit = {
            owner = {
                calc_true_if = {
                    all_owned_province = {
                        has_province_modifier = pa_new_colony_cooldown 
                    }
                    amount = 15
                }
            }
        }
        add_permanent_province_modifier = {
            name = pa_new_colony_increased_cost_1
            duration = 9125		#Currently 25 Years, may need to be lower
        }
    }
}

# province, general conversion through effects
on_province_culture_changed = {
    if = {
        limit = {
    		is_city = no
        }
		change_culture = variable:pre_colonial_culture_var
    }
}

on_province_religion_changed = {
    if = {
        limit = {
    		is_city = no
        }
		change_religion = variable:pre_colonial_religion_var
    }
}

on_buy_religious_reform = {
	events = {
		religious_reforms.1
		religious_reforms.2
		religious_reforms.3
        religious_reforms.4
	}
}